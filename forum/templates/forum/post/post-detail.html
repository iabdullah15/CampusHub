{% extends 'forum/base/base.html' %}
{% load crispy_forms_tags %}

{% load static %}
{% load humanize %}

{% block title %}
    <title>Post Detial</title>
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static 'forum/css/home/home-page.css' %}">
    <link rel="stylesheet" href="{% static 'forum/css/post/create-post.css' %}">

{% endblock %}

{% block js %}

<script defer>
    document.addEventListener("DOMContentLoaded", () => {
      // Event delegation for reply buttons
      document
        .getElementById("comments-container")
        .addEventListener("click", (event) => {
          if (event.target.classList.contains("reply-link")) {
            const commentId = event.target.getAttribute("data-comment-id");
            const replyContainer = event.target
              .closest(".comment")
              .querySelector(".post-comment-reply-container");
            const replyTextarea = replyContainer.querySelector(
              ".reply-comment-textarea"
            );
            const replyBtnsContainer = replyContainer.querySelector(
              ".reply-btn-container"
            );

            replyContainer.style.display = "block";
            replyTextarea.style.display = "block";
            replyTextarea.focus();
            replyBtnsContainer.style.display = "flex";
          }

          if (event.target.classList.contains("cancel-btn-reply")) {
            const replyContainer = event.target.closest(
              ".post-comment-reply-container"
            );
            const replyTextarea = replyContainer.querySelector(
              ".reply-comment-textarea"
            );
            const replyBtnsContainer = replyContainer.querySelector(
              ".reply-btn-container"
            );

            replyContainer.style.display = "none";
            replyTextarea.style.display = "none";
            replyBtnsContainer.style.display = "none";
          }
        });

      // Event listener for comment textarea
      const commentTextarea = document.getElementById(
        "CommentFormControlTextarea1"
      );
      const commentSubmitButton = document.getElementById(
        "CommentSubmitButton"
      );
      const cancelButton = document.getElementById("CancelButton");

      commentTextarea.addEventListener("focus", () => {
        commentSubmitButton.style.display = "inline-block";
        cancelButton.style.display = "inline-block";
      });

      cancelButton.addEventListener("click", () => {
        commentSubmitButton.style.display = "none";
        cancelButton.style.display = "none";
        commentTextarea.blur();
      });
    });
  </script>

{% endblock %}


{% block main %}

  {% if request.user.is_authenticated %}

  <div class="content-wrapper">
    <div class="sidebar bg-light p-3">
      <h5>Feed</h5>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active left-sidebar-link" href="#">My Feed</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Polls</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Popular</a>
        </li>
      </ul>
      <h5 class="mt-3">Communities</h5>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active left-sidebar-link" href="#"
            >Pharmaceutical Sciences</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Languages and Literature</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >IT and Computer Science</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Engineering</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Media and Mass Communication</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Humanities and Social Sciences</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Science and Technology</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Management Sciences</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Law</a>
        </li>
      </ul>
      <h5 class="mt-3">Job Groups</h5>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active left-sidebar-link" href="#"
            >Software Engineering</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Product Managment</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Finance</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Management and Consulting</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Investment Banking & Sell Side</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Finance</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Data Science</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Security</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Information Technology</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Security</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Human Resources</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Operations</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Legal</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Supply Chain</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Customer Service</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Design</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Marketing</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Admin</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Information Technology</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#">Marketing</a>
        </li>
        <li class="nav-item">
          <a class="nav-link left-sidebar-link" href="#"
            >Hardware Engineering</a
          >
        </li>
      </ul>
    </div>

    <div class="main-feed">

      {% if post %}

      <div class="card mb-3 post-card">
        <div class="card-body">
          <h5 class="card-title">
            <a class="back-link btn btn-outline-light" href="">
              <i class="fa-solid fa-arrow-left back-icon"> </i>
            </a>
            {{post.community.community_name}}
            <span style="font-weight: 300; font-size: 1rem"> {{post.time_created|naturaltime}} </span>
          </h5>
          <h5 class="card-title">
            {{post.title}}
          </h5>
          <p class="card-text">
            {{post.body}}
          </p>
          <div class="interaction-container">
            <p class="card-text">
              <small class="text-muted">
                <span class="interaction-button">
                  <i class="fa-regular fa-heart fa-xl heart-icon"></i> 9 likes
                  ·
                </span>
                <span class="interaction-button">
                  <i class="fa-regular fa-message fa-xl comment-icon"></i> 104
                  comments ·
                </span>
                <span class="interaction-button">
                  <i class="fa-regular fa-eye fa-xl views-icon"></i> 1,935
                  views
                </span>
              </small>
            </p>
          </div>
        </div>

        <div class="container-fluid comments-container">
          <form action="{% url 'forum:post_comment' post.id %}" method="post">
            <div class="post-comment-container mb-4">
              {% csrf_token %}

              {{comment_form|crispy}}
              <!-- <label for="CommentFormControlTextarea1" class="form-label"
                >Comment</label
              >
              <textarea
                class="form-control comment-textarea"
                id="CommentFormControlTextarea1"
                rows="2"
              ></textarea> -->
              <div class="comment-btn-container mt-4">

                  <!-- Post comment button -->
                  

                  <button style="display: none" id="CommentSubmitButton" class="btn btn-outline-dark ms-2" type="submit">              
                    Comment
                  </button>

                  <!-- Cancel comment button -->

                  <a
                  id="CancelButton"
                  class="btn btn-outline-dark ms-2"
                  style="display: none"
                >
                  Cancel
                </a>


              </div>

            </div>
          </form>

          <hr class="w-100" />

          <div id="comments-container">
            <div class="comment my-5" data-comment-id="1">
              <div class="card comment-card">
                <div class="card-body">
                  <h6 class="card-title">
                    Department <span>username</span> <span>time-posted</span>
                  </h6>
                  <p class="card-text">
                    Some quick example text to build on the card title and
                    make up the bulk of the card's content.
                  </p>
                </div>
              </div>
              <div class="comment-interaction-container">
                <span class="interaction-button mt-2">
                  <i class="fa-regular fa-heart fa-lg heart-icon"></i> 9
                </span>
                <span class="reply-link" data-comment-id="1">Reply</span>

                <div
                  class="mt-3 post-comment-reply-container mb-4"
                  style="display: none"
                >
                  <textarea
                    class="form-control reply-comment-textarea"
                    style="display: none"
                    rows="2"
                  ></textarea>
                  <div class="reply-btn-container mt-4" style="display: none">
                    <a class="btn btn-outline-dark ms-2 reply-btn">
                      Comment
                    </a>
                    <a class="btn btn-outline-dark ms-2 cancel-btn-reply">
                      Cancel
                    </a>
                  </div>
                </div>
              </div>
              <div class="comment-replies-container">
                <div class="card comment-reply-card">
                  <div class="card-body">
                    <h6 class="card-title">
                      Department <span>username</span>
                      <span>time-posted</span>
                    </h6>
                    <p class="card-text">
                      Some quick example text to build on the card title and
                      make up the bulk of the card's content.
                    </p>
                  </div>
                </div>
                <div class="comment-reply-interaction-container">
                  <span class="interaction-button mt-2">
                    <i class="fa-regular fa-heart fa-lg heart-icon"></i> 9
                  </span>
                </div>
                <div class="card comment-reply-card">
                  <div class="card-body">
                    <h6 class="card-title">
                      Department <span>username</span>
                      <span>time-posted</span>
                    </h6>
                    <p class="card-text">
                      Some quick example text to build on the card title and
                      make up the bulk of the card's content.
                    </p>
                  </div>
                </div>
                <div class="comment-reply-interaction-container">
                  <span class="interaction-button mt-2">
                    <i class="fa-regular fa-heart fa-lg heart-icon"></i> 9
                  </span>
                </div>
              </div>
            </div>

            <div class="comment my-5" data-comment-id="2">
              <div class="card comment-card">
                <div class="card-body">
                  <h6 class="card-title">
                    Department <span>username</span> <span>time-posted</span>
                  </h6>
                  <p class="card-text">
                    Some quick example text to build on the card title and
                    make up the bulk of the card's content.
                  </p>
                </div>
              </div>
              <div class="comment-interaction-container">
                <span class="interaction-button mt-2">
                  <i class="fa-regular fa-heart fa-lg heart-icon"></i> 9
                </span>
                <span class="reply-link" data-comment-id="1">Reply</span>

                <div
                  class="mt-3 post-comment-reply-container mb-4"
                  style="display: none"
                >
                  <textarea
                    class="form-control reply-comment-textarea"
                    style="display: none"
                    rows="2"
                  ></textarea>
                  <div class="reply-btn-container mt-4" style="display: none">
                    <a class="btn btn-outline-dark ms-2 reply-btn">
                      Comment
                    </a>
                    <a class="btn btn-outline-dark ms-2 cancel-btn-reply">
                      Cancel
                    </a>
                  </div>
                </div>
              </div>
              <div class="comment-replies-container">
                <div class="card comment-reply-card">
                  <div class="card-body">
                    <h6 class="card-title">
                      Department <span>username</span>
                      <span>time-posted</span>
                    </h6>
                    <p class="card-text">
                      Some quick example text to build on the card title and
                      make up the bulk of the card's content.
                    </p>
                  </div>
                </div>
                <div class="comment-reply-interaction-container">
                  <span class="interaction-button mt-2">
                    <i class="fa-regular fa-heart fa-lg heart-icon"></i> 9
                  </span>
                </div>
                <div class="card comment-reply-card">
                  <div class="card-body">
                    <h6 class="card-title">
                      Department <span>username</span>
                      <span>time-posted</span>
                    </h6>
                    <p class="card-text">
                      Some quick example text to build on the card title and
                      make up the bulk of the card's content.
                    </p>
                  </div>
                </div>
                <div class="comment-reply-interaction-container">
                  <span class="interaction-button mt-2">
                    <i class="fa-regular fa-heart fa-lg heart-icon"></i> 9
                  </span>
                </div>
              </div>
            </div>

            <!-- Repeat .comment structure for more comments -->
          </div>
        </div>
      </div>

      {% endif %}
    </div>

    <div class="right-sidebar bg-light">
      <h5 class="mt-3 ms-3">Most Read</h5>
      <hr />
      <div class="card right-sidebar-card">
        <ul class="list-group list-group-flush">
          <li class="list-group-item px-2">
            <div class="card-body p-1">
              <h6 class="card-subtitle mb-2 text-body-secondary">
                Category
                <span class="right-sidebar-post-views ms-5"
                  ><i class="fa-regular fa-eye fa-sm views-icon"></i> 1,935
                  views</span
                >
              </h6>
              <h6 class="card-title">Lorem ipsum dolor sit amet.</h6>
            </div>
          </li>
          <li class="list-group-item px-2">
            <div class="card-body p-1">
              <h6 class="card-subtitle mb-2 text-body-secondary">
                Category
                <span class="right-sidebar-post-views ms-5"
                  ><i class="fa-regular fa-eye fa-sm views-icon"></i> 1,935
                  views</span
                >
              </h6>
              <h6 class="card-title">Lorem ipsum dolor sit amet.</h6>
            </div>
          </li>
          <li class="list-group-item px-2">
            <div class="card-body p-1">
              <h6 class="card-subtitle mb-2 text-body-secondary">
                Category
                <span class="right-sidebar-post-views ms-5"
                  ><i class="fa-regular fa-eye fa-sm views-icon"></i> 1,935
                  views</span
                >
              </h6>
              <h6 class="card-title">Lorem ipsum dolor sit amet.</h6>
            </div>
          </li>
          <li class="list-group-item px-2">
            <div class="card-body p-1">
              <h6 class="card-subtitle mb-2 text-body-secondary">
                Category
                <span class="right-sidebar-post-views ms-5"
                  ><i class="fa-regular fa-eye fa-sm views-icon"></i> 1,935
                  views</span
                >
              </h6>
              <h6 class="card-title">Lorem ipsum dolor sit amet.</h6>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>


  {% else %}

  <p>Please login or sign up</p>
  <p><a href="{% url 'user:sign-in' %}"></a></p>

  {% endif %}

{% endblock %}