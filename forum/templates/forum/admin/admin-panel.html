{% extends 'forum/base/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}
    <title>Admin Panel</title>
{% endblock %}

{% block css %}

<link rel="stylesheet" href="{% static 'forum/css/home/home-page.css' %}">
<link rel="stylesheet" href="{% static 'forum/css/profile/profile-page.css' %}">
<link rel="stylesheet" href="{% static 'forum/css/admin/admin-panel.css' %}">

{% endblock %}

{% block main %}

  

  <main class="profile-section">
    <div class="content-wrapper">
      <div class="sidebar bg-light p-3">
        <h5>Admin Panel</h5>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link left-sidebar-link" href="{% url 'forum:home' %}">
              <i class="fa-solid fa-house fa-lg"></i> Home</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link left-sidebar-link" href="#"
              ><i class="fa-solid fa-fire fa-lg"></i> Popular</a
            >
          </li>
        </ul>
        <div class="profile-container">
          <h5 class="mt-3 mb-3">
            <i class="fa-solid fa-user fa-lg"></i> Profile
          </h5>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link left-sidebar-link" href="#"
                ><i class="fa-solid fa-right-from-bracket fa-lg"></i>
                Logout</a
              >
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="main-profile-section">
      <h3 class="mb-3 text-center">Welcome back user123!</h3>

      <div aria-live="polite" aria-atomic="true" class="d-flex justify-content-center align-items-center w-100">
        {% if messages %}
            {% for message in messages %}
            <div id="toastMessage" class="toast align-items-center text-light bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="60000">
                <div class="d-flex">
                    <div class="toast-body">
                    <!-- Display Django messages inside the toast -->
                    {{ message }}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
            {% endfor %}
        {% endif %}
      </div>

      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item profile-nav-tab" role="presentation">
          <a
            class="nav-link active"
            id="simple-tab-0"
            data-bs-toggle="tab"
            href="#simple-tabpanel-0"
            role="tab"
            aria-controls="simple-tabpanel-0"
            aria-selected="true"
            >Overview</a
          >
        </li>
        <li class="nav-item profile-nav-tab" role="presentation">
          <a
            class="nav-link"
            id="simple-tab-1"
            data-bs-toggle="tab"
            href="#simple-tabpanel-1"
            role="tab"
            aria-controls="simple-tabpanel-1"
            aria-selected="false"
            >New Posts Today</a
          >
        </li>
        <li class="nav-item profile-nav-tab" role="presentation">
          <a
            class="nav-link"
            id="simple-tab-2"
            data-bs-toggle="tab"
            href="#simple-tabpanel-2"
            role="tab"
            aria-controls="simple-tabpanel-2"
            aria-selected="false"
            >Reported Posts</a
          >
        </li>
      </ul>
      <div class="tab-content pt-5" id="tab-content">
        <div
          class="tab-pane active"
          id="simple-tabpanel-0"
          role="tabpanel"
          aria-labelledby="simple-tab-0"
        >
          <div class="profile-tab overview-tab ms-3">
            <!-- Tab 1 -->
            <div class="container admin-overview-container">
              <div class="row align-items-start">
                <div class="col">
                  <h6 class="pb-2">Total posts</h6>
                  <h4 class="pb-2">{{post_count}}</h4>  
                </div>
                <div class="col vr-col">
                  <div
                    class="d-flex justify-content-center"
                    style="height: 100px"
                  >
                    <div class="vr"></div>
                  </div>
                </div>
                <div class="col">
                  <h6 class="pb-2">Total Reports</h6>
                  <h4 class="pb-2">{{reported_posts_count}}</h4>
                </div>
              </div>
            </div>
          </div>

          <div class="most-popular-post-container container ms-3">
            <h4 class="mb-3">Most Popular Posts Today</h4>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th scope="col">Image</th>
                  <th scope="col">Title</th>
                  <th scope="col">Date</th>
                  <th scope="col">Views</th>
                  <th scope="col">Likes</th>
                  <th scope="col">Comments</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">
                    <!-- Image -->
                    <div class="container-fluid thumbnail-container">
                      <img
                        src="random.jpg"
                        alt="Thumbnail"
                        class="img-thumbnail admin-panel-thumbnail-img"
                        data-bs-toggle="modal"
                        data-bs-target="#likeImageModal"
                        style="cursor: pointer"
                      />
                    </div>

                    <!-- Modal -->
                    <div
                      class="modal modal-lg fade"
                      id="likeImageModal"
                      tabindex="-1"
                      aria-labelledby="imageModalLabel"
                      aria-hidden="true"
                    >
                      <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                          <div class="modal-header">
                            <button
                              type="button"
                              class="btn-close"
                              data-bs-dismiss="modal"
                              aria-label="Close"
                            ></button>
                          </div>
                          <div class="modal-body">
                            <img
                              src="random.jpg"
                              alt="Full-size Image"
                              class="img-fluid"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </th>
                  <td>This is a post</td>
                  <td>30/05/2024</td>
                  <td>57</td>
                  <td>20</td>
                  <td>4</td>
                </tr>
                <tr>
                  <th scope="row">-</th>
                  <td>This is another post</td>
                  <td>30/05/2024</td>
                  <td>284</td>
                  <td>67</td>
                  <td>32</td>
                </tr>
                <tr>
                  <th scope="row">-</th>
                  <td>This is another post</td>
                  <td>30/05/2024</td>
                  <td>284</td>
                  <td>67</td>
                  <td>32</td>
                </tr>
                <tr>
                  <th scope="row">-</th>
                  <td>This is another post</td>
                  <td>30/05/2024</td>
                  <td>284</td>
                  <td>67</td>
                  <td>32</td>
                </tr>
                <tr>
                  <th scope="row">-</th>
                  <td>This is another post</td>
                  <td>30/05/2024</td>
                  <td>284</td>
                  <td>67</td>
                  <td>32</td>
                </tr>
                <tr>
                  <th scope="row">-</th>
                  <td>This is another post</td>
                  <td>30/05/2024</td>
                  <td>284</td>
                  <td>67</td>
                  <td>32</td>
                </tr>
                <tr>
                  <th scope="row">-</th>
                  <td>This is another post</td>
                  <td>30/05/2024</td>
                  <td>284</td>
                  <td>67</td>
                  <td>32</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div
          class="tab-pane"
          id="simple-tabpanel-1"
          role="tabpanel"
          aria-labelledby="simple-tab-1"
        >
          <!-- tab 2 -->
          <div class="post-tab-container new-posts-tab-container ms-3">
            {% if recent_posts %}

            <h4 class="mb-4">New Posts</h4>

            {% for post in recent_posts %}

              <div class="user-post-card card">
                <div class="card-body">

                  <div
                    class="card-title-container d-flex justify-content-between align-items-center mb-3"
                  >
                    <h5 class="card-title mb-0">
                      <a
                        class="user-post-link"
                        href=""
                      >
                        {{post.title}}
                      </a>
                    </h5>

                    <div class="d-flex align-items-center">
                      <p class="text-muted me-3 mb-0">{{post.time_created|naturaltime}}</p>
                    </div>
                  </div>

                  <!-- Community and Category -->
                  <div class="d-flex align-items-center custom-subtitle-container">
                    <h6 class="card-subtitle mb-0 text-body-secondary">{{ post.author.username }}</h6>
                  </div>
                  <!-- Community and Category -->
                  <div class="d-flex align-items-center custom-subtitle-container mt-2">
                    {% if post.community %}
                    <h6 class="card-subtitle mb-0 text-body-secondary"><a class="subtitle-link" href="{% url 'forum:community_page' post.community.id %}">{{ post.community }}</a></h6>
                    {% endif %}
                    {% if post.community and post.category %}
                    <h6 class="card-subtitle mb-0 text-body-secondary mx-2">-</h6>
                    {% endif %}
                    {% if post.category %}
                    <h6 class="card-subtitle mb-0 text-body-secondary">{{ post.category }}</h6>
                    {% endif %}
                    {% if post.poll %}
                    <h6 class="card-subtitle mb-0 text-body-secondary mx-2">-</h6>
                    <h6 class="card-subtitle mb-0 text-body-secondary">Poll</h6>
                    {% endif %}
                  </div>
                  <!-- Post Body -->
                  <p class="card-text mt-3">{{ post.body|truncatewords:20 }}</p>
                  <!-- Thumbnail -->
                  {% if post.image %}
                  <div class="container-fluid mt-5 thumbnail-container">
                    <img
                      src="{{ post.image.url }}"
                      alt="Thumbnail"
                      class="img-thumbnail"
                      data-bs-toggle="modal"
                      data-bs-target="#imageModal-{{ post.id }}"
                      style="cursor: pointer"
                    />
                  </div>
                  {% endif %}
              
                  <!-- Modal -->
                  {% if post.image %}
                  <div
                    class="modal modal-lg fade"
                    id="imageModal-{{ post.id }}"
                    tabindex="-1"
                    aria-labelledby="imageModalLabel"
                    aria-hidden="true"
                  >
                    <div class="modal-dialog modal-dialog-centered">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                          ></button>
                        </div>
                        <div class="modal-body">
                          <img
                            src="{{ post.image.url }}"
                            alt="Full-size Image"
                            class="img-fluid"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- Interaction Section -->
                  <p class="card-text mt-3">
                    <small class="text-muted"
                      >9 likes · 104 comments</small
                    >
                  </p>
                </div>
              </div>
              {% endfor %}

              {% else %}
              <h4 class="mb-4">No Recent Posts</h4>

            {% endif %}


            </div>


        </div>

        <div
          class="tab-pane"
          id="simple-tabpanel-2"
          role="tabpanel"
          aria-labelledby="simple-tab-2"
        >
          {% if reported_posts %}
          {% for post in reported_posts %}
            <div class="user-post-card card">
              <div class="card-body">
                <div
                  class="card-title-container d-flex justify-content-between align-items-center mb-3"
                >
                  <h5 class="card-title mb-0">
                    <a class="user-post-link" href="{% url 'forum:post_detail' post.id %}">
                      {{ post.title }}
                    </a>
                  </h5>
          
                  <div class="d-flex align-items-center">
                    <p class="text-muted me-3 mb-0">
                      {{ post.time_created|naturaltime }}
                    </p>
                  </div>
                </div>
        
                <!-- Subtitle -->
                <div class="d-flex align-items-center custom-subtitle-container mb-3">
                  {% if post.community %}
                  <h6 class="card-subtitle text-body-secondary me-1">
                    {{ post.community }}
                  </h6>
                  {% endif %}
                  {% if post.community and post.category %}
                  <h6 class="card-subtitle text-body-secondary">-</h6>
                  {% endif %}
                  {% if post.category %}
                  <h6 class="card-subtitle text-body-secondary ms-1">
                    {{ post.category }}
                  </h6>
                  {% endif %}
                </div>
        
                <!-- Post Body -->
                <p class="card-text">{{ post.body|truncatewords:20 }}</p>
        
                <!-- Thumbnail -->
                <div class="container-fluid">
                  {% if post.image %}
                  <img
                    src="{{ post.image.url }}"
                    alt="Thumbnail"
                    class="img-thumbnail"
                    data-bs-toggle="modal"
                    data-bs-target="#imageModal-{{ post.id }}"
                    style="cursor: pointer"
                  />
                  {% endif %}
                </div>
        
                <!-- Modal -->
                <div
                  class="modal modal-lg fade"
                  id="imageModal-{{ post.id }}"
                  tabindex="-1"
                  aria-labelledby="imageModalLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">
                        {% if post.image %}
                        <img
                          src="{{ post.image.url }}"
                          alt="Full-size Image"
                          class="img-fluid"
                        />
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
        
                <!-- Interaction Section -->
                <p class="card-text mt-3 d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    {{ post.total_likes }} likes · {{ post.comments.count }} comments · {{ post.report_count }} reports
                  </small>
                  <a href="{% url 'forum:view_reports' post.id %}" class="text-primary text-decoration-none ms-auto">
                    View reports
                  </a>
                </p>
              </div>
            </div>
          {% endfor %}
          {% else %}
            <p>No reported posts found.</p>
          {% endif %}
        
          </div>

      </div>
    </div>
  </main>

  <script>
      // Trigger toast if there are any messages
      document.addEventListener('DOMContentLoaded', function () {
        var toastEl = document.getElementById('toastMessage');
        var toast = new bootstrap.Toast(toastEl);
        {% if messages %}
          toast.show();
        {% endif %}
      });
  </script>

{% endblock %}